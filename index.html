<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Energy Generation Predictor</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
</head>
<body class="bg-gradient-to-br from-green-100 via-yellow-100 to-blue-100 min-h-screen py-10">
  <div class="max-w-3xl mx-auto bg-white p-8 shadow-2xl rounded-2xl">
    <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">üîã Energy Generation Predictor</h1>

    
    <div class="mb-10">
      <h2 class="text-xl font-semibold mb-2 text-gray-700">Predict Energy Generation</h2>
      <form id="predictionForm" class="space-y-4">
        <div>
          <label for="DAILY_YIELD" class="block font-medium text-gray-700">Daily Yield (kWh generated today)</label>
          <input type="number" id="DAILY_YIELD" name="DAILY_YIELD" required class="w-full px-4 py-2 border rounded-lg"/>
        </div>
        <div>
          <label for="TOTAL_YIELD" class="block font-medium text-gray-700">Total Yield (Total kWh generated by plant till now)</label>
          <input type="number" id="TOTAL_YIELD" name="TOTAL_YIELD" required class="w-full px-4 py-2 border rounded-lg"/>
        </div>
        <div>
          <label for="hour" class="block font-medium text-gray-700">Hour of the Day (0‚Äì23)</label>
          <input type="number" id="hour" name="hour" min="0" max="23" required class="w-full px-4 py-2 border rounded-lg"/>
        </div>
        <div>
          <label for="day_of_week" class="block font-medium text-gray-700">Day of Week (0 = Sunday, 6 = Saturday)</label>
          <input type="number" id="day_of_week" name="day_of_week" min="0" max="6" required class="w-full px-4 py-2 border rounded-lg"/>
        </div>
        <div>
          <label for="month" class="block font-medium text-gray-700">Month (1 = Jan, 12 = Dec)</label>
          <input type="number" id="month" name="month" min="1" max="12" required class="w-full px-4 py-2 border rounded-lg"/>
        </div>
        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg">üîÆ Predict Energy</button>
      </form>
      <div id="predictionResult" class="mt-4 bg-gray-100 p-4 rounded-lg"></div>
    </div>

    <!-- Power Plant Details -->
    <div class="mb-10">
      <h2 class="text-xl font-semibold mb-2 text-gray-700">Power Plant Details</h2>
      <form id="detailsForm" class="space-y-4">
        <div>
          <label for="power_plant_id" class="block font-medium text-gray-700">Power Plant ID (e.g., S1-1, S1-2...)</label>
          <input type="text" id="power_plant_id" name="power_plant_id" required class="w-full px-4 py-2 border rounded-lg"/>
        </div>
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg">üìÑ Get Plant Details</button>
      </form>
      <div id="detailsResult" class="mt-4 bg-gray-100 p-4 rounded-lg"></div>
    </div>

    <!-- Sample Values from CSV -->
    <div>
      <h2 class="text-xl font-semibold mb-2 text-gray-700">üìä Sample Plant Data</h2>
      <button id="loadSampleData" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded-lg">üìÅ View Sample Values for Plants</button>
      <div id="sampleDataResult" class="mt-4 bg-gray-50 p-4 rounded-lg overflow-auto text-sm text-gray-800"></div>
    </div>
  </div>

  <script>
    // Predict Energy
    document.getElementById("predictionForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const data = {
        DAILY_YIELD: parseFloat(document.getElementById("DAILY_YIELD").value),
        TOTAL_YIELD: parseFloat(document.getElementById("TOTAL_YIELD").value),
        hour: parseInt(document.getElementById("hour").value),
        day_of_week: parseInt(document.getElementById("day_of_week").value),
        month: parseInt(document.getElementById("month").value)
      };
      fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(response => {
        if (response.error) {
          document.getElementById("predictionResult").innerHTML = `<strong>Error:</strong> ${response.error}`;
        } else {
          const preds = response.predictions;
          let resultHTML = `<strong>Predictions:</strong><ul>`;
          for (const model in preds) {
            resultHTML += `<li>${model}: ${preds[model].toFixed(2)}</li>`;
          }
          resultHTML += `</ul><strong>Best Model:</strong> ${response.best_model} (${response.best_prediction.toFixed(2)})`;
          document.getElementById("predictionResult").innerHTML = resultHTML;
        }
      })
      .catch(err => {
        document.getElementById("predictionResult").innerHTML = `<strong>Error:</strong> ${err}`;
      });
    });

    // Power Plant Details
    document.getElementById("detailsForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const data = {
        power_plant_id: document.getElementById("power_plant_id").value.trim()
      };
      fetch("/power_plant_details", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(response => {
        if (response.error) {
          document.getElementById("detailsResult").innerHTML = `<strong>Error:</strong> ${response.error}`;
        } else {
          document.getElementById("detailsResult").innerHTML = `
            <strong>Power Plant ID:</strong> ${response.power_plant_id}<br>
            <strong>Location:</strong> ${response.location}<br>
            <strong>Energy Type:</strong> ${response.energy_type}<br>
            <strong>Predicted Generation:</strong> ${response.predicted_generation.toFixed(2)}
          `;
        }
      })
      .catch(err => {
        document.getElementById("detailsResult").innerHTML = `<strong>Error:</strong> ${err}`;
      });
    });

    // Load Sample CSV Data
    document.getElementById("loadSampleData").addEventListener("click", function () {
      fetch("/get_sample_plants")
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            document.getElementById("sampleDataResult").innerHTML = `<strong>Error:</strong> ${data.error}`;
          } else {
            let html = "<table class='min-w-full table-auto border border-gray-300'><thead><tr>";
            const headers = Object.keys(data[0]);
            headers.forEach(header => {
              html += `<th class='border px-2 py-1 bg-gray-200'>${header}</th>`;
            });
            html += "</tr></thead><tbody>";
            data.forEach(row => {
              html += "<tr>";
              headers.forEach(header => {
                html += `<td class='border px-2 py-1'>${row[header]}</td>`;
              });
              html += "</tr>";
            });
            html += "</tbody></table>";
            document.getElementById("sampleDataResult").innerHTML = html;
          }
        })
        .catch(err => {
          document.getElementById("sampleDataResult").innerHTML = `<strong>Error:</strong> ${err}`;
        });
    });
  </script>
</body>
</html>
